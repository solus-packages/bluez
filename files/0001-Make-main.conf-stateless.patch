From aa7ea44e223450f1a6f144b7dca77ca5311a13ba Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Tue, 2 May 2017 14:00:01 +0300
Subject: [PATCH 1/1] Make main.conf stateless Also default to AutoEnable to
 true for automatic controller enabling.

---
 Makefile.in   | 1 +
 configure.ac  | 5 +++++
 src/main.c    | 4 ++++
 src/main.conf | 2 +-
 4 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/Makefile.in b/Makefile.in
index 443b9af..8a77d85 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -2108,6 +2108,7 @@ UDEV_CFLAGS = @UDEV_CFLAGS@
 UDEV_DIR = @UDEV_DIR@
 UDEV_LIBS = @UDEV_LIBS@
 VERSION = @VERSION@
+VENDORDIR = @VENDORDIR@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
diff --git a/configure.ac b/configure.ac
index ff4374b..4be3302 100644
--- a/configure.ac
+++ b/configure.ac
@@ -331,6 +331,11 @@ AC_DEFINE_UNQUOTED(CONFIGDIR, "${configdir}",
 			[Directory for the configuration files])
 AC_SUBST(CONFIGDIR, "${configdir}")
 
+vendordir="${datadir}/defaults/bluetooth"
+AC_DEFINE_UNQUOTED(VENDORDIR, "${vendordir}",
+			[Directory for the vendor-supplied configuration files])
+AC_SUBST(VENDORDIR, "${vendordir}")
+
 AC_ARG_ENABLE(android, AC_HELP_STRING([--enable-android],
 			[enable BlueZ for Android]),
 					[enable_android=${enableval}])
diff --git a/src/main.c b/src/main.c
index bcc1e6f..29dba1d 100644
--- a/src/main.c
+++ b/src/main.c
@@ -638,6 +638,10 @@ int main(int argc, char *argv[])
 
 	main_conf = load_config(CONFIGDIR "/main.conf");
 
+	if (!main_conf) {
+		main_conf = load_config(VENDORDIR "/main.conf");
+	}
+
 	parse_config(main_conf);
 
 	if (connect_dbus() < 0) {
diff --git a/src/main.conf b/src/main.conf
index a649276..a6da84f 100644
--- a/src/main.conf
+++ b/src/main.conf
@@ -93,4 +93,4 @@
 # AutoEnable defines option to enable all controllers when they are found.
 # This includes adapters present on start as well as adapters that are plugged
 # in later on. Defaults to 'false'.
-#AutoEnable=false
+AutoEnable=true
-- 
2.12.2

